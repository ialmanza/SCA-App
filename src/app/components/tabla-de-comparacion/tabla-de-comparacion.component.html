<div class="table-container">
  <app-notifications></app-notifications>

  <div *ngIf="loading" class="professional-loading-container">
    <div class="professional-spinner">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
    </div>
    <div class="loading-content">
      <h3>{{ 'comparisonTable.loading.message' | translate }}</h3>
      <p>{{ 'comparisonTable.loading.subtitle' | translate }}</p>
      <div class="loading-progress">
        <div class="progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- Mensaje de error si existe -->
  <div *ngIf="error && !loading" class="error-message">
    <fa-icon [icon]="faExclamationCircle" class="error-icon"></fa-icon>
    <p>{{ error }}</p>
  </div>

  <!-- Indicador de guardado -->
  <div *ngIf="saving" class="professional-loading-container">
    <div class="professional-spinner">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
    </div>
    <div class="loading-content">
      <h3>{{ 'comparisonTable.saving.message' | translate }}</h3>
      <p>{{ 'comparisonTable.saving.subtitle' | translate }}</p>
      <div class="loading-progress">
        <div class="progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- Contenido de la tabla cuando hay datos -->
  <ng-container *ngIf="!loading && !error">
    <ng-container *ngIf="opciones.length > 0 && comparisonModes.length > 0; else noData">
      <div class="debug-info" style="margin-bottom: 10px; font-size: 0.8em; color: #555">
        {{ 'comparisonTable.debug.options' | translate }}: {{ opciones.length }} | {{ 'comparisonTable.debug.modes' | translate }}: {{ comparisonModes.length }}
      </div>

      <div class="table-wrapper">
        <table class="comparison-table">
          <thead>
            <tr>
              <th rowspan="2" class="opciones-column">{{ 'comparisonTable.headers.decisionOptions' | translate }}</th>
              <th [attr.colspan]="comparisonModes.length" class="areas-header">{{ 'comparisonTable.headers.comparisonAreas' | translate }}</th>
            </tr>
            <tr class="label-headers">
              <th *ngFor="let mode of comparisonModes; trackBy: trackByFn" class="mode-header">
                <div class="mode-label">{{ mode.label }}</div>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let opcion of opciones; trackBy: trackByFn">
              <td class="opciones-column">
                <div class="opcion-label">{{ opcion.descripcion }}</div>
              </td>
              <td *ngFor="let mode of comparisonModes" class="area-cell">
                <div class="counter-container">
                  <button
                    class="counter-btn decrease"
                    (click)="decrement(opcion.id, mode.id, $event)"
                    [attr.data-cell-id]="getCellKey(opcion.id, mode.id)"
                    [disabled]="getCellValue(opcion.id, mode.id) <= 0 || saving"
                    [attr.aria-label]="'comparisonTable.buttons.decrement' | translate">
                    <fa-icon [icon]="faMinus"></fa-icon>
                  </button>
                  <span class="counter-value">{{ getCellValue(opcion.id, mode.id) }}</span>
                  <button
                    class="counter-btn increase"
                    (click)="increment(opcion.id, mode.id, $event)"
                    [attr.data-cell-id]="getCellKey(opcion.id, mode.id)"
                    [disabled]="getCellValue(opcion.id, mode.id) >= 5 || saving"
                    [attr.aria-label]="'comparisonTable.buttons.increment' | translate">
                    <fa-icon [icon]="faPlus"></fa-icon>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="actions-container">
        <button
          class="action-button save-button"
          (click)="saveAllCells()"
          [disabled]="!hasUnsavedChanges() || saving"
          [attr.aria-label]="'comparisonTable.buttons.saveLabel' | translate">
          <fa-icon [icon]="faSave" class="button-icon"></fa-icon>
          <span *ngIf="!saving">{{ 'comparisonTable.buttons.save' | translate }}</span>
          <span *ngIf="saving">{{ 'comparisonTable.buttons.saving' | translate }}</span>
        </button>
        <button
          class="action-button reset-button"
          (click)="resetTable()"
          [disabled]="!hasUnsavedChanges() || saving"
          [attr.aria-label]="'comparisonTable.buttons.reset' | translate">
          <fa-icon [icon]="faUndo" class="button-icon"></fa-icon>
          {{ 'comparisonTable.buttons.reset' | translate }}
        </button>
      </div>
    </ng-container>

    <!-- Mensaje cuando no hay datos -->
    <ng-template #noData>
      <div class="no-data-message">
        <fa-icon [icon]="faExclamationCircle" class="no-data-icon"></fa-icon>
        <p>{{ 'comparisonTable.noData.message' | translate }}</p>
        <div class="debug-info" style="margin-top: 10px; font-size: 0.8em; color: #555">
          {{ 'comparisonTable.debug.options' | translate }}: {{ opciones.length }} | {{ 'comparisonTable.debug.modes' | translate }}: {{ comparisonModes.length }}
        </div>
      </div>
    </ng-template>
  </ng-container>
</div>
